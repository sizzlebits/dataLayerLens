var he=Object.defineProperty;var ye=(r,t,s)=>t in r?he(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var f=(r,t,s)=>ye(r,typeof t!="symbol"?t+"":t,s);import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{R as C,r as v}from"./iframe-d2sodY_R.js";import{D as Y,a as T,S as Z,C as ve}from"./index-YHEJibdA.js";import{F as be}from"./FilterPanel-C6wOhIiR.js";import{E as fe}from"./EventStats-CJgwgLry.js";import{m as u}from"./proxy-oLp51Ffe.js";import{c as A}from"./createLucideIcon-B5oPKDXb.js";import{C as we}from"./ColorSwatch-B6zHs2xM.js";import{a as je,C as Ne}from"./clock-DWTjRa6l.js";import{A as E}from"./index-pUis7lPG.js";import{L as _,H as Ee,M as Se,Z as re,S as se}from"./zap-BOWfXx7X.js";import{C as Te}from"./chevron-down-BNRKPvBn.js";import{X as M}from"./x-gYhyWlMT.js";import{P as D}from"./plus-BsDFT6l8.js";import{T as ne}from"./Toggle-BjEVimMI.js";import"./SearchInput-BLBg9OMp.js";import{S as Le}from"./search-B462KUoz.js";import{D as Ce}from"./download-DQ1P-CAn.js";import{T as ke}from"./trash-2-CcuZx_2c.js";import{S as De}from"./SupportLink-C9YXK4qC.js";import"./preload-helper-Dp1pzeXC.js";import"./filter-iGNtTwyB.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=A("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=A("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=A("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=A("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),I=()=>{if(typeof browser<"u")return browser;if(typeof chrome<"u")return chrome;throw new Error("No browser extension API available")};class Fe{constructor(t){f(this,"storage");this.storage=t}get(t){return new Promise((s,a)=>{this.storage.get(t??null,i=>{const o=I();o.runtime.lastError?a(new Error(o.runtime.lastError.message)):s(i)})})}set(t){return new Promise((s,a)=>{this.storage.set(t,()=>{const i=I();i.runtime.lastError?a(new Error(i.runtime.lastError.message)):s()})})}remove(t){return new Promise((s,a)=>{this.storage.remove(t,()=>{const i=I();i.runtime.lastError?a(new Error(i.runtime.lastError.message)):s()})})}}class qe{constructor(t){f(this,"local");f(this,"onChanged");this.local=new Fe(t.storage.local),this.onChanged={addListener:s=>{t.storage.onChanged.addListener(s)},removeListener:s=>{t.storage.onChanged.removeListener(s)}}}}class Re{constructor(t){f(this,"api");this.api=t}get lastError(){return this.api.runtime.lastError}sendMessage(t){return new Promise((s,a)=>{this.api.runtime.sendMessage(t,i=>{this.api.runtime.lastError?a(new Error(this.api.runtime.lastError.message)):s(i)})})}get onMessage(){return{addListener:t=>{this.api.runtime.onMessage.addListener(t)},removeListener:t=>{this.api.runtime.onMessage.removeListener(t)}}}getURL(t){return this.api.runtime.getURL(t)}}class _e{constructor(t){f(this,"api");this.api=t}query(t){return new Promise((s,a)=>{this.api.tabs.query(t,i=>{this.api.runtime.lastError?a(new Error(this.api.runtime.lastError.message)):s(i)})})}sendMessage(t,s){return new Promise((a,i)=>{this.api.tabs.sendMessage(t,s,o=>{this.api.runtime.lastError?i(new Error(this.api.runtime.lastError.message)):a(o)})})}get onRemoved(){return{addListener:t=>{this.api.tabs.onRemoved.addListener(t)},removeListener:t=>{this.api.tabs.onRemoved.removeListener(t)}}}}class Pe{constructor(t){f(this,"api");this.api=t}executeScript(t){return this.api.scripting.executeScript({target:{tabId:t.target.tabId,frameIds:t.target.frameIds,allFrames:t.target.allFrames},files:t.files})}}class Ge{constructor(t){f(this,"api");this.api=t}get onClicked(){return{addListener:t=>{var s,a;(a=(s=this.api.action)==null?void 0:s.onClicked)==null||a.addListener(t)},removeListener:t=>{var s,a;(a=(s=this.api.action)==null?void 0:s.onClicked)==null||a.removeListener(t)}}}}class Oe{constructor(t){f(this,"runtime");f(this,"storage");f(this,"tabs");f(this,"scripting");f(this,"action");const s=t??I();this.runtime=new Re(s),this.storage=new qe(s),this.tabs=new _e(s),this.scripting=new Pe(s),s.action&&(this.action=new Ge(s))}}let R=null;function He(){return R||(R=new Oe),R}const Ue=He(),Q=r=>{let t;const s=new Set,a=(g,x)=>{const b=typeof g=="function"?g(t):g;if(!Object.is(b,t)){const h=t;t=x??(typeof b!="object"||b===null)?b:Object.assign({},t,b),s.forEach(d=>d(t,h))}},i=()=>t,l={setState:a,getState:i,getInitialState:()=>p,subscribe:g=>(s.add(g),()=>s.delete(g))},p=t=r(a,i,l);return l},$e=(r=>r?Q(r):Q),Ve=r=>r;function We(r,t=Ve){const s=C.useSyncExternalStore(r.subscribe,C.useCallback(()=>t(r.getState()),[r,t]),C.useCallback(()=>t(r.getInitialState()),[r,t]));return C.useDebugValue(s),s}const ee=r=>{const t=$e(r),s=a=>We(t,a);return Object.assign(s,t),s},Be=(r=>r?ee(r):ee),ae="datalayer_monitor_settings",ze=500;function Ke(r){const{browserAPI:t,maxEvents:s=ze,settingsKey:a=ae}=r;return(i,o)=>({settings:Y,events:[],isLoading:!0,filter:"",expandedEvents:new Set,loadSettings:async()=>{try{const l=(await t.storage.local.get(a))[a]||{},p={...Y,...l,grouping:{...T,...l.grouping||{}}};i({settings:p,isLoading:!1})}catch(n){console.error("Failed to load settings:",n),i({isLoading:!1})}},updateSettings:async n=>{const p={...o().settings,...n};i({settings:p});try{await t.storage.local.set({[a]:p});const x=(await t.tabs.query({active:!0,currentWindow:!0}))[0];x!=null&&x.id&&(t.tabs.sendMessage(x.id,{type:"UPDATE_SETTINGS",payload:p}).catch(()=>{}),t.runtime.sendMessage({type:"SETTINGS_UPDATED",payload:n,tabId:x.id}).catch(()=>{}))}catch(g){console.error("Failed to save settings:",g)}},loadEvents:async()=>{try{const l=(await t.tabs.query({active:!0,currentWindow:!0}))[0];if(l!=null&&l.id){const p=await t.tabs.sendMessage(l.id,{type:"GET_EVENTS"});p!=null&&p.events&&i({events:p.events})}}catch(n){console.error("Failed to load events:",n)}},clearEvents:async()=>{try{const l=(await t.tabs.query({active:!0,currentWindow:!0}))[0];l!=null&&l.id&&(await t.tabs.sendMessage(l.id,{type:"CLEAR_EVENTS"}),i({events:[]}))}catch(n){console.error("Failed to clear events:",n)}},setFilter:n=>{i({filter:n})},toggleEventExpanded:n=>{const l=new Set(o().expandedEvents);l.has(n)?l.delete(n):l.add(n),i({expandedEvents:l})},addEvent:n=>{const l=[n,...o().events];i({events:l.slice(0,s)})}})}function Je(r){const t=Be(Ke(r));return{useStore:t,setupStorageListener:(i=ae)=>{const o=(n,l)=>{l==="local"&&n[i]&&t.setState({settings:n[i].newValue})};return r.browserAPI.storage.onChanged.addListener(o),()=>{r.browserAPI.storage.onChanged.removeListener(o)}},setupMessageListener:()=>{const i=o=>{const n=o;(n.type==="EVENT_ADDED"||n.type==="DATALAYER_EVENT")&&n.payload&&t.getState().addEvent(n.payload)};return r.browserAPI.runtime.onMessage.addListener(i),()=>{r.browserAPI.runtime.onMessage.removeListener(i)}}}}const Xe=typeof browser<"u"?browser:Ue,{useStore:Ye,setupStorageListener:Ze,setupMessageListener:Qe}=Je({browserAPI:Xe,maxEvents:500,settingsKey:"datalayer_monitor_settings"});Ze();Qe();const te=typeof browser<"u"?browser:chrome;function et(){const{settings:r,loadSettings:t,updateSettings:s,events:a,loadEvents:i,clearEvents:o,isLoading:n}=Ye(),[l,p]=v.useState("main"),[g,x]=v.useState(""),[b,h]=v.useState(!1),[d,w]=v.useState(""),[L,F]=v.useState({}),[G,O]=v.useState(null),H=v.useRef(null),[U,$]=v.useState(!1),[V,W]=v.useState(""),[B,z]=v.useState(!1),[K,J]=v.useState("");v.useEffect(()=>{t(),i(),X(),m()},[t,i]);const X=async()=>{try{const[c]=await te.tabs.query({active:!0,currentWindow:!0});if(c!=null&&c.url){const y=new URL(c.url);w(y.hostname)}}catch{}},m=async()=>{try{const c=await te.runtime.sendMessage({type:"GET_DOMAIN_SETTINGS"});c!=null&&c.domainSettings&&F(c.domainSettings)}catch{}};return{settings:r,loadSettings:t,updateSettings:s,events:a,clearEvents:o,isLoading:n,activeTab:l,setActiveTab:p,newLayerName:g,setNewLayerName:x,isAddingLayer:b,setIsAddingLayer:h,currentDomain:d,setCurrentDomain:w,domainSettings:L,setDomainSettings:F,loadDomainSettings:m,importStatus:G,setImportStatus:O,fileInputRef:H,isAddingFilter:U,setIsAddingFilter:$,filterSearch:V,setFilterSearch:W,isAddingTrigger:B,setIsAddingTrigger:z,triggerSearch:K,setTriggerSearch:J}}const k=typeof browser<"u"?browser:chrome;function tt({settings:r,updateSettings:t,events:s,newLayerName:a,setNewLayerName:i,setIsAddingLayer:o,setDomainSettings:n,loadDomainSettings:l,loadSettings:p,setImportStatus:g,fileInputRef:x,setIsAddingFilter:b,setFilterSearch:h,setIsAddingTrigger:d,setTriggerSearch:w}){return{addDataLayerName:()=>{a&&!r.dataLayerNames.includes(a)&&(t({dataLayerNames:[...r.dataLayerNames,a]}),i(""),o(!1))},removeDataLayerName:m=>{t({dataLayerNames:r.dataLayerNames.filter(c=>c!==m)})},deleteDomain:async m=>{try{await k.runtime.sendMessage({type:"DELETE_DOMAIN_SETTINGS",domain:m}),n(c=>{const y={...c};return delete y[m],y})}catch(c){console.error("Failed to delete domain settings:",c)}},saveCurrentDomainSettings:async m=>{try{await k.runtime.sendMessage({type:"UPDATE_SETTINGS",domain:m,saveGlobal:!1,payload:{eventFilters:r.eventFilters,filterMode:r.filterMode,dataLayerNames:r.dataLayerNames,grouping:r.grouping,persistEvents:r.persistEvents}}),l()}catch(c){console.error("Failed to save domain settings:",c)}},exportSettings:async()=>{try{const m=await k.runtime.sendMessage({type:"EXPORT_ALL_SETTINGS"}),c=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),y=URL.createObjectURL(c),j=document.createElement("a");j.href=y,j.download=`datalayer-monitor-settings-${new Date().toISOString().split("T")[0]}.json`,j.click(),URL.revokeObjectURL(y)}catch(m){console.error("Failed to export settings:",m)}},exportEvents:async()=>{const m=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),c=URL.createObjectURL(m),y=document.createElement("a");y.href=c,y.download=`datalayer-events-${new Date().toISOString().split("T")[0]}.json`,y.click(),URL.revokeObjectURL(c)},importSettings:async m=>{var y;const c=(y=m.target.files)==null?void 0:y[0];if(c){try{const j=await c.text(),q=JSON.parse(j);if(!q.globalSettings&&!q.domainSettings){g("Invalid settings file");return}const N=await k.runtime.sendMessage({type:"IMPORT_ALL_SETTINGS",payload:q});N!=null&&N.success?(g("Settings imported successfully!"),p(),l()):g((N==null?void 0:N.error)||"Import failed")}catch(j){g("Failed to parse settings file"),console.error("Failed to import settings:",j)}setTimeout(()=>g(null),3e3),x.current&&(x.current.value="")}},addFilter:m=>{r.eventFilters.includes(m)||t({eventFilters:[...r.eventFilters,m]}),h(""),b(!1)},removeFilter:m=>{t({eventFilters:r.eventFilters.filter(c=>c!==m)})},clearFilters:()=>{t({eventFilters:[]})},setFilterMode:m=>{t({filterMode:m})},addTriggerEvent:m=>{var y;const c=((y=r.grouping)==null?void 0:y.triggerEvents)||T.triggerEvents;c.includes(m)||t({grouping:{...r.grouping||T,triggerEvents:[...c,m]}}),w(""),d(!1)},removeTriggerEvent:m=>{var y;const c=((y=r.grouping)==null?void 0:y.triggerEvents)||T.triggerEvents;t({grouping:{...r.grouping||T,triggerEvents:c.filter(j=>j!==m)}})},handleSourceColorChange:(m,c)=>{t({sourceColors:{...r.sourceColors,[m]:c}})}}}function ie({settings:r,events:t,currentDomain:s,onClearEvents:a,onExportEvents:i,onAddFilter:o,onRemoveFilter:n,onClearFilters:l,onSetFilterMode:p}){return e.jsxs(u.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 space-y-4",children:[e.jsx(be,{filters:r.eventFilters,filterMode:r.filterMode,onAddFilter:o,onRemoveFilter:n,onClearFilters:l,onSetFilterMode:p}),e.jsx("div",{className:"bg-dl-card rounded-xl p-4 border border-dl-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-dl-dark rounded-lg",children:e.jsx(Ae,{className:"w-5 h-5 text-dl-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"View Events in DevTools"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Press F12, then select the DataLayer Lens tab"})]})]})}),e.jsx(fe,{eventCount:t.length,maxEvents:r.maxEvents,onClear:a,onExport:i}),e.jsx("div",{className:"text-center text-xs text-slate-500 py-2",children:e.jsxs("p",{children:[s&&e.jsx("span",{className:"block mb-1 text-dl-accent",children:s}),"Monitoring:"," ",r.dataLayerNames.map((g,x)=>e.jsxs("span",{children:[e.jsx("code",{className:"text-dl-accent",children:g}),x<r.dataLayerNames.length-1&&", "]},g))]})})]},"main")}ie.__docgenInfo={description:"",methods:[],displayName:"MonitorTab",props:{settings:{required:!0,tsType:{name:"Settings"},description:""},events:{required:!0,tsType:{name:"Array",elements:[{name:"DataLayerEvent"}],raw:"DataLayerEvent[]"},description:""},currentDomain:{required:!0,tsType:{name:"string"},description:""},onClearEvents:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onExportEvents:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onAddFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filter: string) => void",signature:{arguments:[{type:{name:"string"},name:"filter"}],return:{name:"void"}}},description:""},onRemoveFilter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filter: string) => void",signature:{arguments:[{type:{name:"string"},name:"filter"}],return:{name:"void"}}},description:""},onClearFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSetFilterMode:{required:!0,tsType:{name:"signature",type:"function",raw:"(mode: 'include' | 'exclude') => void",signature:{arguments:[{type:{name:"union",raw:"'include' | 'exclude'",elements:[{name:"literal",value:"'include'"},{name:"literal",value:"'exclude'"}]},name:"mode"}],return:{name:"void"}}},description:""}}};function oe({dataLayerNames:r,sourceColors:t,onAddDataLayer:s,onRemoveDataLayer:a,onColorChange:i}){const[o,n]=v.useState(!1),[l,p]=v.useState(""),[g,x]=v.useState(null),b=()=>{l.trim()&&!r.includes(l.trim())&&(s(l.trim()),p(""),n(!1))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-dl-primary"}),"DataLayer Arrays"]}),e.jsxs("div",{className:"bg-dl-card rounded-lg border border-dl-border overflow-hidden",children:[e.jsx("div",{className:"space-y-0",children:e.jsx(E,{children:r.map(h=>{const d=t[h]||Z[0],w=g===h;return e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-b border-dl-border last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 hover:bg-dl-dark/50 transition-colors",children:[e.jsxs("button",{onClick:()=>x(w?null:h),className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0 border border-white/20",style:{backgroundColor:d}}),e.jsx(_,{className:"w-3 h-3 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-mono text-white truncate",children:h}),e.jsx(u.div,{animate:{rotate:w?180:0},transition:{duration:.2},className:"ml-auto",children:e.jsx(Te,{className:"w-4 h-4 text-slate-400"})})]}),h!=="dataLayer"&&e.jsx(u.button,{onClick:()=>a(h),className:"p-1 text-slate-400 hover:text-dl-error hover:bg-dl-error/20 rounded transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(M,{className:"w-3.5 h-3.5"})})]}),e.jsx(E,{children:w&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"border-t border-dl-border bg-dl-dark/30",children:e.jsx(we,{colors:Z,selectedColor:d,onSelect:L=>{i(h,L),x(null)}})})})})]},h)})})}),e.jsx(E,{mode:"wait",children:o?e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center gap-2 p-3 border-t border-dl-border",children:[e.jsx("input",{type:"text",value:l,onChange:h=>p(h.target.value),onKeyDown:h=>h.key==="Enter"&&b(),placeholder:"e.g., dataLayer_v2",className:"flex-1 bg-dl-dark border border-dl-border rounded-lg px-3 py-2 text-sm text-white placeholder:text-slate-500 focus:border-dl-primary focus:outline-none",autoFocus:!0}),e.jsx(u.button,{onClick:b,className:"p-2 bg-dl-success/20 hover:bg-dl-success/30 text-dl-success rounded-lg",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx(u.button,{onClick:()=>{n(!1),p("")},className:"p-2 bg-dl-error/20 hover:bg-dl-error/30 text-dl-error rounded-lg",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(M,{className:"w-4 h-4"})})]},"input"):e.jsxs(u.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>n(!0),className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 border-t border-dl-border text-slate-400 hover:text-dl-primary hover:bg-dl-dark/50 transition-colors",whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx(D,{className:"w-4 h-4"}),"Add DataLayer"]},"add-btn")})]})]})}oe.__docgenInfo={description:"",methods:[],displayName:"DataLayerConfig",props:{dataLayerNames:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},sourceColors:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"},description:""},onAddDataLayer:{required:!0,tsType:{name:"signature",type:"function",raw:"(name: string) => void",signature:{arguments:[{type:{name:"string"},name:"name"}],return:{name:"void"}}},description:""},onRemoveDataLayer:{required:!0,tsType:{name:"signature",type:"function",raw:"(name: string) => void",signature:{arguments:[{type:{name:"string"},name:"name"}],return:{name:"void"}}},description:""},onColorChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(source: string, color: string) => void",signature:{arguments:[{type:{name:"string"},name:"source"},{type:{name:"string"},name:"color"}],return:{name:"void"}}},description:""}}};function le({value:r,onChange:t,min:s=10,max:a=200,step:i=10}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-300",children:"Max Events"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:s,max:a,step:i,value:r,onChange:o=>t(Number(o.target.value)),className:"flex-1 accent-dl-primary"}),e.jsx("span",{className:"text-sm text-dl-accent font-mono w-12 text-right",children:r})]})]})}le.__docgenInfo={description:"",methods:[],displayName:"MaxEventsSlider",props:{value:{required:!0,tsType:{name:"number"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: number) => void",signature:{arguments:[{type:{name:"number"},name:"value"}],return:{name:"void"}}},description:""},min:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}},max:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"200",computed:!1}},step:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}}}};function S({icon:r,iconColor:t,title:s,description:a,checked:i,onChange:o}){return e.jsxs("div",{className:"flex items-center justify-between bg-dl-card rounded-lg px-4 py-3 border border-dl-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{className:`w-4 h-4 ${t}`}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white block",children:s}),a&&e.jsx("span",{className:"text-xs text-slate-500",children:a})]})]}),e.jsx(ne,{checked:i,onChange:o})]})}function de({showTimestamps:r,persistEvents:t,consoleLogging:s,debugLogging:a,compactMode:i,onUpdateSettings:o}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{icon:Ne,iconColor:"text-dl-accent",title:"Show Timestamps",checked:r,onChange:n=>o({showTimestamps:n})}),e.jsx(S,{icon:Ee,iconColor:"text-yellow-400",title:"Persist Events",description:"Keep events across page refreshes",checked:t,onChange:n=>o({persistEvents:n})}),e.jsx(S,{icon:Se,iconColor:"text-dl-primary",title:"Compact Mode",description:"Smaller UI in DevTools panel",checked:i,onChange:n=>o({compactMode:n})}),e.jsx(S,{icon:re,iconColor:"text-dl-accent",title:"Console Logging",description:"Log events to browser console",checked:s,onChange:n=>o({consoleLogging:n})}),e.jsx(S,{icon:se,iconColor:"text-slate-400",title:"Debug Logging",description:"Extension debug info in console",checked:a,onChange:n=>o({debugLogging:n})})]})}de.__docgenInfo={description:"",methods:[],displayName:"DisplaySettings",props:{showTimestamps:{required:!0,tsType:{name:"boolean"},description:""},persistEvents:{required:!0,tsType:{name:"boolean"},description:""},consoleLogging:{required:!0,tsType:{name:"boolean"},description:""},debugLogging:{required:!0,tsType:{name:"boolean"},description:""},compactMode:{required:!0,tsType:{name:"boolean"},description:""},onUpdateSettings:{required:!0,tsType:{name:"signature",type:"function",raw:`(settings: Partial<{
  showTimestamps: boolean;
  persistEvents: boolean;
  consoleLogging: boolean;
  debugLogging: boolean;
  compactMode: boolean;
}>) => void`,signature:{arguments:[{type:{name:"Partial",elements:[{name:"signature",type:"object",raw:`{
  showTimestamps: boolean;
  persistEvents: boolean;
  consoleLogging: boolean;
  debugLogging: boolean;
  compactMode: boolean;
}`,signature:{properties:[{key:"showTimestamps",value:{name:"boolean",required:!0}},{key:"persistEvents",value:{name:"boolean",required:!0}},{key:"consoleLogging",value:{name:"boolean",required:!0}},{key:"debugLogging",value:{name:"boolean",required:!0}},{key:"compactMode",value:{name:"boolean",required:!0}}]}}],raw:`Partial<{
  showTimestamps: boolean;
  persistEvents: boolean;
  consoleLogging: boolean;
  debugLogging: boolean;
  compactMode: boolean;
}>`},name:"settings"}],return:{name:"void"}}},description:""}}};const rt=["gtm.js","gtm.dom","gtm.load","page_view","virtualPageView"],st={enabled:!1,mode:"time",timeWindowMs:500,triggerEvents:["gtm.js","page_view"]};function ce({grouping:r,onUpdateGrouping:t}){const[s,a]=v.useState(!1),[i,o]=v.useState(""),n=r||st,l=()=>{t({...n,enabled:!n.enabled})},p=d=>{t({...n,mode:d})},g=d=>{t({...n,timeWindowMs:d})},x=d=>{d.trim()&&!n.triggerEvents.includes(d.trim())&&t({...n,triggerEvents:[...n.triggerEvents,d.trim()]}),o(""),a(!1)},b=d=>{t({...n,triggerEvents:n.triggerEvents.filter(w=>w!==d)})},h=rt.filter(d=>d.toLowerCase().includes(i.toLowerCase())&&!n.triggerEvents.includes(d));return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-dl-primary"}),"Event Grouping"]}),e.jsxs("div",{className:"flex items-center justify-between bg-dl-card rounded-lg px-4 py-3 border border-dl-border",children:[e.jsx("span",{className:"text-sm text-white",children:"Enable Grouping"}),e.jsx(ne,{checked:n.enabled,onChange:l})]}),n.enabled&&e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p("time"),className:`flex-1 py-2 px-3 text-xs rounded-lg border transition-colors ${n.mode==="time"?"bg-dl-primary/20 border-dl-primary text-dl-primary":"border-dl-border text-slate-400 hover:text-white"}`,children:"Time Window"}),e.jsx("button",{onClick:()=>p("event"),className:`flex-1 py-2 px-3 text-xs rounded-lg border transition-colors ${n.mode==="event"?"bg-dl-primary/20 border-dl-primary text-dl-primary":"border-dl-border text-slate-400 hover:text-white"}`,children:"Trigger Events"})]}),n.mode==="time"&&e.jsx("div",{className:"flex gap-2",children:[200,500,1e3].map(d=>e.jsxs("button",{onClick:()=>g(d),className:`flex-1 py-1.5 text-xs rounded border transition-colors ${n.timeWindowMs===d?"bg-dl-accent/20 border-dl-accent text-dl-accent":"border-dl-border text-slate-400 hover:text-white"}`,children:[d,"ms"]},d))}),n.mode==="event"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Events that start a new group:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.triggerEvents.map(d=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-dl-primary/20 text-dl-primary",children:[d,e.jsx("button",{onClick:()=>b(d),className:"hover:text-white",children:e.jsx(M,{className:"w-3 h-3"})})]},d))}),e.jsx(E,{children:s?e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-500"}),e.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),onKeyDown:d=>{d.key==="Enter"&&i.trim()?x(i):d.key==="Escape"&&(a(!1),o(""))},placeholder:"Event name...",className:"w-full bg-dl-dark border border-dl-border rounded-lg pl-8 pr-8 py-1.5 text-xs text-white placeholder:text-slate-500 focus:border-dl-primary focus:outline-none",autoFocus:!0}),e.jsx("button",{onClick:()=>{a(!1),o("")},className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white",children:e.jsx(M,{className:"w-3.5 h-3.5"})})]}),h.length>0&&e.jsx("div",{className:"bg-dl-dark border border-dl-border rounded-lg overflow-hidden",children:h.slice(0,4).map(d=>e.jsxs("button",{onClick:()=>x(d),className:"w-full flex items-center justify-between px-3 py-1.5 text-xs text-slate-300 hover:bg-dl-border hover:text-white transition-colors",children:[e.jsx("span",{children:d}),e.jsx(D,{className:"w-3.5 h-3.5 text-dl-primary"})]},d))}),i&&!h.includes(i)&&e.jsxs("button",{onClick:()=>x(i),className:"w-full flex items-center justify-center gap-2 py-1.5 text-xs text-dl-primary hover:text-dl-accent transition-colors",children:[e.jsx(D,{className:"w-3.5 h-3.5"}),'Add "',i,'"']})]}):e.jsxs(u.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>a(!0),className:"text-xs text-dl-primary hover:text-dl-accent flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),"Add trigger event"]})})]})]})]})}ce.__docgenInfo={description:"",methods:[],displayName:"GroupingSettings",props:{grouping:{required:!0,tsType:{name:"union",raw:"GroupingConfig | undefined",elements:[{name:"GroupingConfig"},{name:"undefined"}]},description:""},onUpdateGrouping:{required:!0,tsType:{name:"signature",type:"function",raw:"(grouping: GroupingConfig) => void",signature:{arguments:[{type:{name:"GroupingConfig"},name:"grouping"}],return:{name:"void"}}},description:""}}};function me({onExport:r,onImport:t,importStatus:s}){const a=v.useRef(null),i=()=>{var n;(n=a.current)==null||n.click()},o=n=>{t(n),a.current&&(a.current.value="")};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-300",children:"Backup & Restore Settings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u.button,{onClick:r,className:"flex-1 flex items-center justify-center gap-2 py-2.5 px-4 bg-dl-card border border-dl-border hover:border-dl-primary text-slate-300 hover:text-white rounded-lg transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(Ce,{className:"w-4 h-4"}),"Export"]}),e.jsxs(u.button,{onClick:i,className:"flex-1 flex items-center justify-center gap-2 py-2.5 px-4 bg-dl-card border border-dl-border hover:border-dl-primary text-slate-300 hover:text-white rounded-lg transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(Me,{className:"w-4 h-4"}),"Import"]}),e.jsx("input",{ref:a,type:"file",accept:".json",onChange:o,className:"hidden"})]}),s&&e.jsx(u.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:`text-xs text-center py-2 rounded ${s.includes("success")?"text-green-400 bg-green-500/10":"text-red-400 bg-red-500/10"}`,children:s})]})}me.__docgenInfo={description:"",methods:[],displayName:"BackupRestore",props:{onExport:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onImport:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: React.ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{type:{name:"ReactChangeEvent",raw:"React.ChangeEvent<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},name:"event"}],return:{name:"void"}}},description:""},importStatus:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};function ue({settings:r,onUpdateSettings:t,onExportSettings:s,onImportSettings:a,importStatus:i}){return e.jsxs(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-4 space-y-4",children:[e.jsx(oe,{dataLayerNames:r.dataLayerNames,sourceColors:r.sourceColors||{},onAddDataLayer:o=>t({dataLayerNames:[...r.dataLayerNames,o]}),onRemoveDataLayer:o=>t({dataLayerNames:r.dataLayerNames.filter(n=>n!==o)}),onColorChange:(o,n)=>t({sourceColors:{...r.sourceColors,[o]:n}})}),e.jsx(le,{value:r.maxEvents,onChange:o=>t({maxEvents:o})}),e.jsx(de,{showTimestamps:r.showTimestamps,persistEvents:r.persistEvents,consoleLogging:r.consoleLogging,debugLogging:r.debugLogging,compactMode:r.compactMode,onUpdateSettings:t}),e.jsx(ce,{grouping:r.grouping,onUpdateGrouping:o=>t({grouping:o})}),e.jsx(me,{onExport:s,onImport:a,importStatus:i})]},"settings")}ue.__docgenInfo={description:"",methods:[],displayName:"SettingsTab",props:{settings:{required:!0,tsType:{name:"Settings"},description:""},onUpdateSettings:{required:!0,tsType:{name:"signature",type:"function",raw:"(settings: Partial<Settings>) => void",signature:{arguments:[{type:{name:"Partial",elements:[{name:"Settings"}],raw:"Partial<Settings>"},name:"settings"}],return:{name:"void"}}},description:""},onExportSettings:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onImportSettings:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: React.ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{type:{name:"ReactChangeEvent",raw:"React.ChangeEvent<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},name:"event"}],return:{name:"void"}}},description:""},importStatus:{required:!0,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};function pe({domain:r,hasCustomSettings:t,onSaveSettings:s}){return r?e.jsxs("div",{className:"bg-dl-card rounded-lg p-3 border border-dl-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-dl-primary"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Current Site"})]}),t&&e.jsx("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded",children:"Custom"})]}),e.jsx("code",{className:"text-xs text-dl-accent block mb-2",children:r}),!t&&e.jsx(u.button,{onClick:s,className:"w-full text-xs py-1.5 px-3 bg-dl-primary/20 hover:bg-dl-primary/30 text-dl-primary border border-dl-primary/30 rounded transition-colors",whileTap:{scale:.98},children:"Save current settings for this domain"})]}):null}pe.__docgenInfo={description:"",methods:[],displayName:"CurrentDomain",props:{domain:{required:!0,tsType:{name:"string"},description:""},hasCustomSettings:{required:!0,tsType:{name:"boolean"},description:""},onSaveSettings:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function ge({domains:r,onDeleteDomain:t}){const s=Object.entries(r);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-300",children:"Saved Domain Overrides"}),s.length===0?e.jsxs("div",{className:"text-center py-6 text-slate-500 text-sm",children:[e.jsx(P,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No domain overrides saved"}),e.jsx("p",{className:"text-xs mt-1",children:"Use the button above to save settings specific to each domain you visit"})]}):e.jsx("div",{className:"space-y-2",children:e.jsx(E,{children:s.map(([a,i])=>e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-between bg-dl-card rounded-lg px-3 py-2 border border-dl-border group",children:[e.jsxs("div",{children:[e.jsx("code",{className:"text-xs text-dl-accent block",children:a}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Updated ",new Date(i.updatedAt).toLocaleDateString()]})]}),e.jsx(u.button,{onClick:()=>t(a),className:"opacity-0 group-hover:opacity-100 p-1.5 hover:bg-dl-error/20 rounded transition-all",whileHover:{scale:1.1},whileTap:{scale:.9},title:"Remove domain settings",children:e.jsx(ke,{className:"w-3.5 h-3.5 text-dl-error"})})]},a))})})]})}ge.__docgenInfo={description:"",methods:[],displayName:"DomainList",props:{domains:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"DomainSettings"}],raw:"Record<string, DomainSettings>"},description:""},onDeleteDomain:{required:!0,tsType:{name:"signature",type:"function",raw:"(domain: string) => void",signature:{arguments:[{type:{name:"string"},name:"domain"}],return:{name:"void"}}},description:""}}};function xe({currentDomain:r,domainSettings:t,onSaveCurrentDomain:s,onDeleteDomain:a}){return e.jsxs(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-4 space-y-4 max-h-80 overflow-y-auto",children:[e.jsx(pe,{domain:r,hasCustomSettings:!!t[r],onSaveSettings:s}),e.jsx(ge,{domains:t,onDeleteDomain:a}),e.jsx("div",{className:"text-xs text-slate-500 text-center pt-2 border-t border-dl-border",children:e.jsx("p",{children:"Domain settings override global settings when you visit that site"})})]},"domains")}xe.__docgenInfo={description:"",methods:[],displayName:"DomainsTab",props:{currentDomain:{required:!0,tsType:{name:"string"},description:""},domainSettings:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"DomainSettings"}],raw:"Record<string, DomainSettings>"},description:""},onSaveCurrentDomain:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onDeleteDomain:{required:!0,tsType:{name:"signature",type:"function",raw:"(domain: string) => void",signature:{arguments:[{type:{name:"string"},name:"domain"}],return:{name:"void"}}},description:""}}};function nt(){const r=et(),t=tt({settings:r.settings,updateSettings:r.updateSettings,events:r.events,clearEvents:r.clearEvents,newLayerName:r.newLayerName,setNewLayerName:r.setNewLayerName,setIsAddingLayer:r.setIsAddingLayer,setDomainSettings:r.setDomainSettings,loadDomainSettings:r.loadDomainSettings,loadSettings:r.loadSettings,setImportStatus:r.setImportStatus,fileInputRef:r.fileInputRef,setIsAddingFilter:r.setIsAddingFilter,setFilterSearch:r.setFilterSearch,setIsAddingTrigger:r.setIsAddingTrigger,setTriggerSearch:r.setTriggerSearch});if(r.isLoading)return e.jsx("div",{className:"w-80 h-96 flex items-center justify-center bg-dl-dark",children:e.jsx(u.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(Ie,{className:"w-8 h-8 text-dl-primary"})})});const s=[{id:"main",label:"Monitor",icon:re},{id:"settings",label:"Settings",icon:se},{id:"domains",label:"Domains",icon:P}];return e.jsxs("div",{className:"w-80 h-[28rem] flex flex-col bg-gradient-to-br from-dl-dark to-dl-darker",children:[e.jsx(u.header,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"flex-shrink-0 bg-gradient-to-r from-dl-primary/20 to-dl-secondary/20 px-4 py-3 border-b border-dl-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u.div,{whileHover:{rotate:180},transition:{duration:.3},className:"w-10 h-10 bg-gradient-to-br from-dl-primary to-dl-secondary rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-white tracking-tight",children:"DataLayer Lens"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Track your GTM events with clarity"})]})]})}),e.jsx("div",{className:"flex-shrink-0 flex border-b border-dl-border",children:s.map(a=>e.jsxs(u.button,{onClick:()=>r.setActiveTab(a.id),className:`flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium transition-colors relative ${r.activeTab===a.id?"text-dl-accent":"text-slate-400 hover:text-slate-200"}`,whileHover:{backgroundColor:"rgba(255,255,255,0.05)"},whileTap:{scale:.98},children:[e.jsx(a.icon,{className:"w-4 h-4"}),a.label,r.activeTab===a.id&&e.jsx(u.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-dl-primary to-dl-accent"})]},a.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs(E,{mode:"wait",children:[r.activeTab==="main"&&e.jsx(ie,{settings:r.settings,events:r.events,currentDomain:r.currentDomain,onClearEvents:r.clearEvents,onExportEvents:t.exportEvents,onAddFilter:t.addFilter,onRemoveFilter:t.removeFilter,onClearFilters:t.clearFilters,onSetFilterMode:t.setFilterMode},"main"),r.activeTab==="settings"&&e.jsx(ue,{settings:r.settings,onUpdateSettings:r.updateSettings,onExportSettings:t.exportSettings,onImportSettings:t.importSettings,importStatus:r.importStatus},"settings"),r.activeTab==="domains"&&e.jsx(xe,{currentDomain:r.currentDomain,domainSettings:r.domainSettings,onSaveCurrentDomain:()=>t.saveCurrentDomainSettings(r.currentDomain),onDeleteDomain:t.deleteDomain},"domains")]})}),e.jsx(u.footer,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"flex-shrink-0 px-4 py-2 border-t border-dl-border bg-dl-darker/80 backdrop-blur-sm",children:e.jsx(De,{})})]})}nt.__docgenInfo={description:"",methods:[],displayName:"Popup"};export{nt as Popup};
